<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <title>J-Grader</title>
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css" media="screen"/>
    <link type="text/css" rel="stylesheet" href="css/style.css" media="screen"/>
    <link type="text/css" rel="stylesheet" href="css/codemirror/codemirror.css" media="screen"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
    <script src="js/materialize.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="js/moment.min.js"></script>
    <script type="text/javascript" src="js/scripts.js"></script>
    <script type="text/javascript" src="js/vkbeautify.js"></script>
    <script type="text/javascript" src="js/codemirror/codemirror.js"></script>
    <script type="text/javascript" src="js/codemirror/mode/xml/xml.js"></script>
    <script>
            //Make sure that we have an auth-key. This doesn't ensure that its valid.
            //Only that one exists in local storage, there's really no need to ensure its
            //validity since all subsequent API calls would fail with an invalid Authorization header.
            //The worst case is that someone can get to a broken index page and make no API calls.

        </script>
</head>
<body class="grey darken-3">
<header>

    <nav>
        <div class="nav-wrapper grey darken-3">
            <a href="" class="brand-logo white-text">Grader</a>
            <ul id="nav-mobile" class="right hide-on-med-and-down">
                <li><a class="blue-text" href="addStudent.html">Add Student</a></li>
                <li><a class="white-text" href="allStudents.html">All Students</a></li>
                <li><a class="white-text" href="status.html">Add Class</a></li>
                <li><a class="white-text" href="tools.html">All Students</a></li>
            </ul>
        </div>
    </nav>

</header>
<main>

    <div class="container">
        <div class="row">
            <h1 class="center">Add Student</h1>
            <form class="col s12">
                <div class="row">
                    <div class="input-field col s6">
                        <input id="student_id" type="number" class="validate">
                        <label for="student_id">ID</label>
                    </div>
                    <div class="input-field col s6 darken-3">
                        <input id="first_name" type="text" class="validate">
                        <label for="first_name">First Name</label>
                    </div>
                    <div class="input-field col s6">
                        <input id="last_name" type="text" class="validate">
                        <label for="last_name">Last Name</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12">
                        <input id="email" type="email" class="validate">
                        <label for="email">Email</label>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <a class="waves-effect waves-light btn" id="add_student" onclick="validate()">Add Student</a>
        </div>
    </div>
</main>
<footer class="page-footer grey darken-3 hide-on-med-and-down">
    <div class="container">
        <div class="right" id="txt"></div>
    </div>
</footer>
<footer class="page-footer grey darken-3 hide-on-med-and-down">
    <div class="footer-copyright grey darken-2">
        <div class="container">2019 Designed By Jay Patel </div>
    </div>
</footer>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var colElems = document.querySelectorAll('.collapsible');
        var toolElems = document.querySelectorAll('.tooltipped');

    });


    var studentsName;

        function validate(){
          console.log("inside validate");
          if(document.getElementById("student_id").value == ""){
            console.log("ID empty");
            alert("Id is empty");
          }
          else if(document.getElementById("first_name").value == ""){
             alert("First name is empty");
          }
          else if (document.getElementById("last_name").value == ""){
            alert("Last Name is empty");
          }
          else if(document.getElementById("email").value != ""){
            if((document.getElementById("email").value).includes(" ") || !(document.getElementById("email").value).includes(".") || !(document.getElementById("email").value).includes("@")){
                alert("Email format is not correct");
            }
            else{
                addStudent(document.getElementById("first_name").value,document.getElementById("last_name").value,document.getElementById("student_id").value,document.getElementById("email").value)
            }
          }
          else{
            addStudent(document.getElementById("first_name").value,document.getElementById("last_name").value,document.getElementById("student_id").value,document.getElementById("email").value)
          }
        }

        //This function add a student
            function addStudent(firstName,lastName,studentId,email){
                var studentToPost = {"studentId":studentId,"firstname":firstName, "lastname":lastName, "email":email};
                var jsonData = JSON.stringify(studentToPost);
                    $.ajax({
                      type: 'POST',
                      url: "http://localhost:8080/add/student",
                      data: jsonData,
                      contentType: "application/json"
                    }, function() {
                       console.log("getJSON error.");
                   }).done(function() {
                       console.log("getStudent completed");
                       M.toast({html: 'Student added', classes: 'rounded green'});
                       clearAll();
                   }).fail(function() {
                       console.log("getStudent failed.");
                       M.toast({html: 'Failed to add Student', classes: 'rounded red'});
                   });
                }

         //clears all the fields
         function clearAll(){
          console.log("inside ClearAll");
          document.getElementById("student_id").value = null;
          document.getElementById("first_name").value = null;
          document.getElementById("last_name").value = null;
          document.getElementById("email").value = null
        }
        </script>
</body>
</html>